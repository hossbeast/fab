/* Copyright (c) 2012-2013 Todd Freed <todd.freed@gmail.com>

   This file is part of fab.
   
   fab is free software: you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation, either version 3 of the License, or
   (at your option) any later version.
   
   fab is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.
   
   You should have received a copy of the GNU General Public License
   along with fab.  If not, see <http://www.gnu.org/licenses/>. */

# definitions
$dcommon = [ $*/common ~ j ]
+[ $dcommon/vars.fab ]

# source invocations
+[ $dcommon ]()																																	@common
+[ $dlibxapi ](-$libxapi)																												@libxapi
+[ $dlibxlinux ](-$libxlinux;     $libxapi)																			@libxlinux
+[ $dlibpstring ](-$libpstring; 	$libxapi $libxlinux)													@liblistwise
+[ $dliblistwise ](-$liblistwise; $libxapi $libxlinux $libpstring)							@liblistwise
+[ $dlistwise ](-$listwise;       $libxapi $libxlinux $libpstring $liblistwise)	@listwise
+[ $dfab ](-$fab; -$faboplist;    $libxapi $libxlinux $libpstring $liblistwise)	@fab

# default target - make everything
[ @all ] 				: [ @libxapi.all @libxlinux.all @libpstring.all @liblistwise.all @listwise.all @fab.all ]

# inter-module dependencies
[ $libxlinux ]	 :^ [ $libxapi ]
[ $libpstring ]  :^ [ $libxapi $libxlinux ]
[ $liblistwise ] :^ [ $libxapi $libxlinux $libpstring ]
[ $listwise ]		 :^ [ $libxapi $libxlinux $libpstring $liblistwise ]
[ $fab ]				 :^ [ $libxapi $libxlinux $libpstring $liblistwise ]
[ $faboplist ]	 :^ [ $libxapi $libxlinux $libpstring $liblistwise ]

# supertasks
[ @install ]		: [ @xapi.install @libxlinux.install @libpstring.install @liblistwise.install @listwise.install @fab.install ]

# create scripts
[ @scripts ]
{
	exec 2>/dev/null
	fab --bslic-fab -k [ $*/make64.sh ] @all
	fab --bslic-fab -k [ $*/install64.sh ] +n @install -K destdir -K incdir -K bindir -K libdir -K dlibdir -K lwopdir -K fablwopdir -K fabcachedir -K fabtmpdir -K fabinvokedir

	fab --bslic-fab -v '$dbug=["[" 1 "]"]' -k [ $*/make64-debug.sh ] @all
	fab --bslic-fab -v '$dbug=["[" 1 "]"]' -k [ $*/install64-debug.sh ] +n @install -K destdir -K incdir -K bindir -K libdir -K dlibdir -K lwopdir -K fablwopdir -K fabcachedir -K fabtmpdir -K fabinvokedir

	fab --bslic-fab -v '$dvel=["[" 1 "]"]' -k [ $*/make64-devel.sh ] @all
	fab --bslic-fab -v '$dvel=["[" 1 "]"]' -k [ $*/install64-devel.sh ] +n @install -K destdir -K incdir -K bindir -K libdir -K dlibdir -K lwopdir -K fablwopdir -K fabcachedir -K fabtmpdir -K fabinvokedir
}
