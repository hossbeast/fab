#!/usr/bin/perl

use strict;
use warnings;

# dependency target
my $target = $ARGV[0];

my @S;	# strong
my @W;	# weak

while(<STDIN>)
{
	if(/^[^:]+:$/)	# -MP lines, only
	{
		my $line = substr $_, 0, -2;	# exclude trailing newline and colon

		if($line =~ /\.lex\.h$/)
		{
			push @S, $line;				# strong dependency on the header
			$line =~ s/\.lex\.h/.lex.o/;
			push @W, $line;				# weak dependency on the object
		}
		elsif($line =~ /\.tab\.h$/)
		{
			push @S, $line;				# strong dependency on the header
			$line =~ s/\.tab\.h/.tab.o/;
			push @W, $line;				# weak dependency on the object
		}
		else
		{
			push @S, $line;				# strong dependency on the header

			# corresponding .c file
			$line =~ s/\.h$/.c/;

			if(-f $line)
			{
				$line =~ s/\.c$/.o/;
				push @W, $line;			# weak dependency on the object, if the c file exists
			}
		}
	}
}

if(@S)
{
	print "[ $target ] : [\n";
	print "$_\n" for @S;
	print "]\n";
}

if(@W)
{
	print "[ $target ] :* [\n";
	print "$_\n" for @W;
	print "]\n";
}
