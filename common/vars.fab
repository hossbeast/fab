/* Copyright (c) 2012-2013 Todd Freed <todd.freed@gmail.com>

   This file is part of fab.
   
   fab is free software: you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation, either version 3 of the License, or
   (at your option) any later version.
   
   fab is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.
   
   You should have received a copy of the GNU General Public License
   along with fab.  If not, see <http://www.gnu.org/licenses/>. */

$VERSIONL				= [ 0 5 0 0 ]											# version list - major, minor, revision, build
$VERSIONS				= [ v [ $VERSIONL ~ j/. ] ~ j ]		# version string
$VERSIONN				= [ $VERSIONL ~ j/s/^0//g ] 			# version number

# source directories
$dlibxapi				= [ $dcommon/../libxapi ~ j ]
$dlibxlinux			= [ $dcommon/../libxlinux ~ j ]
$dliblistwise		= [ $dcommon/../liblistwise ~ j ]
$dlibpstring		= [ $dcommon/../libpstring ~ j ]
$dlistwise			= [ $dcommon/../listwise ~ j ]
$dfab						= [ $dcommon/../fab ~ j ]

#
# under devel :
#  - disable compiler optimizations
#  - enable compiler debug symbol generation
#  - include additional logging categories and cmdline options related to logging
#   - the --backtrace* options
#   - the --logtrace* options
#   - the *TOKEN and *STATE logging catories
#   - SANITY logging categories and related options
#  - disable ug+s check (to facilitate execution under valgrind)
#  - enable compilation options to use files from the source directories, including :
#   - listwise operators
#   - fab-listwise operators
#   - fab-provided invocations
#   - libraries, via rpath
#
$devel					= [ 0 ]

# install directories (these are suitable for ubuntu-64)
$destdir				= [ ]															# root install directory - does not affect runtime directories
$incdir					= [ /usr/include ]								# header files
$bindir					= [ /usr/local/bin ]							# executables
$libdir					= [ /usr/lib/x86_64-linux-gnu ]		# dynamically linked libraries

#
# configurable runtime directories
#  (that may be set at build-time)
#

# install-time values
$dlibdir								= [ /usr/lib ]										# dloaded libraries
$fabcachedir						= [ /var/cache/fab ]							# fab cache
$fabtmpdir							= [ /var/tmp/fab ]								# fab tmp
$fabipcdir							= [ /var/run/fab ]								# fab shm/ipc files
$lwopdir								= [
	[ $devel ~ [ j/s/0/< $dlibdir/listwise >/y ~ j ] ]			# lw operators - regular build
	[ $devel ~ [ s/1/< [ $dliblistwise  ] /op>/y ~ j ] ]		# lw operators - devel build
]
$fablwopdir							= [
	[ $devel ~ [ j/s/0/< $dlibdir/fab/lib >/y ~ j ] ]				# fab-specific lw operators - regular build
	[ $devel ~ [ s/1/< $dfab/fablw/op>/y ~ j ] ]						# fab-specific lw operators - devel build
]
$fabinvokedir						= [
	[ $devel ~ [ j/s/0/< $dlibdir/fab/listwise >/y ~ j ] ]	# fab-provided invocations - regular build
	[ $devel ~ [ s/1/< $dfab/fablib >/y ~ j ] ]							# fab-provided invocations - devel build
]

# compilers and their flags
$flex				= [ flex ]
$flexflags	= [ ]

$bison			= [ bison ]
$bisonflags	= [ --warnings=error ]

$cc					= [ gcc ]
$cflags     = [ -m64 -Wall -Werror -D_GNU_SOURCE -fplan9-extensions
		# include paths
	[ $dlibxapi $dlibxlinux $dliblistwise $dlibpstring [ $dcommon ~ lsr/c/-d ] ~ s/^/-I ]
	[ -DXAPI_UNWIND ]
	[ $devel ~ s/1/-O0/y ]				# compiler optimizations
	[ $devel ~ j/s/0/-O3/y ]
	[ $devel ~ s/1/-g/y ]					# debug symbol generation
	[ $devel ~ s/1/-DXAPI_RUNTIME_CHECKS/y ]
	[ $devel ~ s/1/-DSANITY/y ]
	[ $devel ~ s/1/-DDEVEL/y ]
]

$lflags			= [
	[ $devel ~ [ "s/1/<-Wl,-rpath," [ $dlibxapi ] >/y ~ j ] ]
	[ $devel ~ [ "s/1/<-Wl,-rpath," [ $dlibxlinux ] >/y ~ j ] ]
	[ $devel ~ [ "s/1/<-Wl,-rpath," [ $dlibpstring ] >/y ~ j ] ]
	[ $devel ~ [ "s/1/<-Wl,-rpath," [ $dliblistwise ] >/y ~ j ] ]
]

# default library names
$libxapi			= [ -lxapi ]
$libxlinux		= [ -lxlinux ]
$liblistwise	= [ -llistwise ]
$libpstring		= [ -lpstring ]
